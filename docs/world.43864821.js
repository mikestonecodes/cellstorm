!function(){function t(t){return t&&t.__esModule?t.default:t}function e(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){return s(t,e)}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function h(t,i){return!i||"object"!=((r=i)&&r.constructor===Symbol?"symbol":typeof r)&&"function"!=typeof i?e(t):i;var r}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function l(t,e,i){return(l=u()?Reflect.construct:function(t,e,i){var r=[null];r.push.apply(r,e);var n=new(Function.bind.apply(t,r));return i&&_setPrototypeOf(n,i.prototype),n}).apply(null,arguments)}function c(t,e,i){return l.apply(null,arguments)}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t){return d(t)}function g(t){var e="function"==typeof Map?new Map:void 0;return g=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return c(t,arguments,f(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,t)},g(t)}function v(t){return g(t)}function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=f(t);if(e){var n=f(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return h(this,i)}}function m(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function y(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function E(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function b(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function x(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function A(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function _(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function w(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function T(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function F(t,e){var i=e[0],r=e[1],n=e[2],s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function S(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function k(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[0],o=i[1],h=i[2];return t[0]=n*h-s*o,t[1]=s*a-r*h,t[2]=r*o-n*a,t}var R,I,P=(R=[0,0,0],I=[0,0,0],function(t,e){y(R,t),y(I,e),F(R,R),F(I,I);var i=S(R,I);return i>1?0:i<-1?Math.PI:Math.acos(i)});var M=function(t){"use strict";o(s,t);var r=p(s);function s(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;return i(this,s),h(t=r.call(this,n,a,o),e(t))}return n(s,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=t}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return t.length?this.copy(t):(E(this,t,e,i),this)}},{key:"copy",value:function(t){return y(this,t),this}},{key:"add",value:function(t,e){return e?b(this,t,e):b(this,this,t),this}},{key:"sub",value:function(t,e){return e?x(this,t,e):x(this,this,t),this}},{key:"multiply",value:function(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2]):A(this,this,t),this}},{key:"divide",value:function(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2]):A(this,this,1/t),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return T(this,t),this}},{key:"len",value:function(){return m(this)}},{key:"distance",value:function(t){return t?(e=this,r=(i=t)[0]-e[0],n=i[1]-e[1],s=i[2]-e[2],Math.sqrt(r*r+n*n+s*s)):m(this);var e,i,r,n,s}},{key:"squaredLen",value:function(){return _(this)}},{key:"squaredDistance",value:function(t){return t?(e=this,r=(i=t)[0]-e[0],n=i[1]-e[1],s=i[2]-e[2],r*r+n*n+s*s):_(this);var e,i,r,n,s}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return w(this,t),this}},{key:"cross",value:function(t,e){return e?k(this,t,e):k(this,this,t),this}},{key:"scale",value:function(t){return A(this,this,t),this}},{key:"normalize",value:function(){return F(this,this),this}},{key:"dot",value:function(t){return S(this,t)}},{key:"equals",value:function(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1]&&e[2]===i[2];var e,i}},{key:"applyMatrix4",value:function(t){var e,i,r,n,s,a,o;return e=this,r=t,n=(i=this)[0],s=i[1],a=i[2],o=(o=r[3]*n+r[7]*s+r[11]*a+r[15])||1,e[0]=(r[0]*n+r[4]*s+r[8]*a+r[12])/o,e[1]=(r[1]*n+r[5]*s+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*s+r[10]*a+r[14])/o,this}},{key:"scaleRotateMatrix4",value:function(t){var e,i,r,n,s,a,o;return e=this,r=t,n=(i=this)[0],s=i[1],a=i[2],o=(o=r[3]*n+r[7]*s+r[11]*a+r[15])||1,e[0]=(r[0]*n+r[4]*s+r[8]*a)/o,e[1]=(r[1]*n+r[5]*s+r[9]*a)/o,e[2]=(r[2]*n+r[6]*s+r[10]*a)/o,this}},{key:"applyQuaternion",value:function(t){return function(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[0],o=i[1],h=i[2],u=o*s-h*n,l=h*r-a*s,c=a*n-o*r,d=o*c-h*l,f=h*u-a*c,g=a*l-o*u,v=2*i[3];u*=v,l*=v,c*=v,d*=2,f*=2,g*=2,t[0]=r+u+d,t[1]=n+l+f,t[2]=s+c+g}(this,this,t),this}},{key:"angle",value:function(t){return P(this,t)}},{key:"lerp",value:function(t,e){return function(t,e,i,r){var n=e[0],s=e[1],a=e[2];t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=a+r*(i[2]-a)}(this,this,t,e),this}},{key:"clone",value:function(){return new s(this[0],this[1],this[2])}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}},{key:"transformDirection",value:function(t){var e=this[0],i=this[1],r=this[2];return this[0]=t[0]*e+t[4]*i+t[8]*r,this[1]=t[1]*e+t[5]*i+t[9]*r,this[2]=t[2]*e+t[6]*i+t[10]*r,this.normalize()}}]),s}(v(Array)),L=new M,O=1,D=1,U=!1,B=function(){"use strict";function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var n in i(this,t),e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=r,this.id=O++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state,r)this.addAttribute(n,r[n])}return n(t,[{key:"addAttribute",value:function(t,e){if(this.attributes[t]=e,e.id=D++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.buffer||(e.buffer=this.gl.createBuffer(),this.updateAttribute(e)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}},{key:"updateAttribute",value:function(t){this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}},{key:"setIndex",value:function(t){this.addAttribute("index",t)}},{key:"setDrawRange",value:function(t,e){this.drawRange.start=t,this.drawRange.count=e}},{key:"setInstancedCount",value:function(t){this.instancedCount=t}},{key:"createVAO",value:function(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}},{key:"bindAttributes",value:function(t){var e=this;t.attributeLocations.forEach((function(t,i){var r=i.name,n=i.type;if(e.attributes[r]){var s=e.attributes[r];e.gl.bindBuffer(s.target,s.buffer),e.glState.boundBuffer=s.buffer;var a=1;35674===n&&(a=2),35675===n&&(a=3),35676===n&&(a=4);for(var o=s.size/a,h=1===a?0:a*a*a,u=1===a?0:a*a,l=0;l<a;l++)e.gl.vertexAttribPointer(t+l,o,s.type,s.normalized,s.stride+h,s.offset+l*u),e.gl.enableVertexAttribArray(t+l),e.gl.renderer.vertexAttribDivisor(t+l,s.divisor)}else console.warn("active attribute ".concat(r," not being supplied"))})),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}},{key:"draw",value:function(t){var e=t.program,i=t.mode,r=void 0===i?this.gl.TRIANGLES:i,n=this;this.gl.renderer.currentGeometry!=="".concat(this.id,"_").concat(e.attributeOrder)&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry="".concat(this.id,"_").concat(e.attributeOrder)),e.attributeLocations.forEach((function(t,e){var i=e.name,r=n.attributes[i];r.needsUpdate&&n.updateAttribute(r)})),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(r,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(r,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(r,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(r,this.drawRange.start,this.drawRange.count)}},{key:"getPosition",value:function(){var t=this.attributes.position;return t.data?t:U?void 0:(console.warn("No position buffer data found to compute bounds"),U=!0)}},{key:"computeBoundingBox",value:function(t){t||(t=this.getPosition());var e=t.data,i=t.offset||0,r=t.stride||t.size;this.bounds||(this.bounds={min:new M,max:new M,center:new M,scale:new M,radius:1/0});var n=this.bounds.min,s=this.bounds.max,a=this.bounds.center,o=this.bounds.scale;n.set(1/0),s.set(-1/0);for(var h=i,u=e.length;h<u;h+=r){var l=e[h],c=e[h+1],d=e[h+2];n.x=Math.min(l,n.x),n.y=Math.min(c,n.y),n.z=Math.min(d,n.z),s.x=Math.max(l,s.x),s.y=Math.max(c,s.y),s.z=Math.max(d,s.z)}o.sub(s,n),a.add(n,s).divide(2)}},{key:"computeBoundingSphere",value:function(t){t||(t=this.getPosition());var e=t.data,i=t.offset||0,r=t.stride||t.size;this.bounds||this.computeBoundingBox(t);for(var n=0,s=i,a=e.length;s<a;s+=r)L.fromArray(e,s),n=Math.max(n,this.bounds.center.squaredDistance(L));this.bounds.radius=Math.sqrt(n)}},{key:"remove",value:function(){for(var t in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[t]),delete this.VAOs[t];for(var e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}]),t}(),N=1,C={},G=function(){"use strict";function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.vertex,s=r.fragment,a=r.uniforms,o=void 0===a?{}:a,h=r.transparent,u=void 0!==h&&h,l=r.cullFace,c=void 0===l?e.BACK:l,d=r.frontFace,f=void 0===d?e.CCW:d,g=r.depthTest,v=void 0===g||g,p=r.depthWrite,m=void 0===p||p,y=r.depthFunc,E=void 0===y?e.LESS:y;i(this,t),e.canvas||console.error("gl not passed as fist argument to Program"),this.gl=e,this.uniforms=o,this.id=N++,n||console.warn("vertex shader not supplied"),s||console.warn("fragment shader not supplied"),this.transparent=u,this.cullFace=c,this.frontFace=f,this.depthTest=v,this.depthWrite=m,this.depthFunc=E,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));var b=e.createShader(e.VERTEX_SHADER);e.shaderSource(b,n),e.compileShader(b),""!==e.getShaderInfoLog(b)&&console.warn("".concat(e.getShaderInfoLog(b),"\nVertex Shader\n").concat(z(n)));var x=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(x,s),e.compileShader(x),""!==e.getShaderInfoLog(x)&&console.warn("".concat(e.getShaderInfoLog(x),"\nFragment Shader\n").concat(z(s))),this.program=e.createProgram(),e.attachShader(this.program,b),e.attachShader(this.program,x),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))return console.warn(e.getProgramInfoLog(this.program));e.deleteShader(b),e.deleteShader(x),this.uniformLocations=new Map;for(var A=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS),_=0;_<A;_++){var w=e.getActiveUniform(this.program,_);this.uniformLocations.set(w,e.getUniformLocation(this.program,w.name));var T=w.name.match(/(\w+)/g);w.uniformName=T[0],3===T.length?(w.isStructArray=!0,w.structIndex=Number(T[1]),w.structProperty=T[2]):2===T.length&&isNaN(Number(T[1]))&&(w.isStruct=!0,w.structProperty=T[1])}this.attributeLocations=new Map;for(var F=[],S=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES),k=0;k<S;k++){var R=e.getActiveAttrib(this.program,k),I=e.getAttribLocation(this.program,R.name);F[I]=R.name,this.attributeLocations.set(R,I)}this.attributeOrder=F.join("")}return n(t,[{key:"setBlendFunc",value:function(t,e,i,r){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=r,t&&(this.transparent=!0)}},{key:"setBlendEquation",value:function(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}},{key:"applyState",value:function(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}},{key:"use",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.flipFaces,i=void 0!==e&&e,r=this,n=-1,s=this.gl.renderer.currentProgram===this.id;s||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((function(t,e){var i=e.uniformName,s=r.uniforms[i];if(e.isStruct&&(s=s[e.structProperty],i+=".".concat(e.structProperty)),e.isStructArray&&(s=s[e.structIndex][e.structProperty],i+="[".concat(e.structIndex,"].").concat(e.structProperty)),!s)return X("Active uniform ".concat(i," has not been supplied"));if(s&&void 0===s.value)return X("".concat(i," uniform is missing a value parameter"));if(s.value.texture)return n+=1,s.value.update(n),V(r.gl,e.type,t,n);if(s.value.length&&s.value[0].texture){var a=[];return s.value.forEach((function(t){n+=1,t.update(n),a.push(n)})),V(r.gl,e.type,t,a)}V(r.gl,e.type,t,s.value)})),this.applyState(),i&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}},{key:"remove",value:function(){this.gl.deleteProgram(this.program)}}]),t}();function V(t,e,i,r){r=r.length?function(t){var e=t.length,i=t[0].length;if(void 0===i)return t;var r=e*i,n=C[r];n||(C[r]=n=new Float32Array(r));for(var s=0;s<e;s++)n.set(t[s],s*i);return n}(r):r;var n=t.renderer.state.uniformLocations.get(i);if(r.length)if(void 0===n||n.length!==r.length)t.renderer.state.uniformLocations.set(i,r.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(var i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}(n,r))return;n.set?n.set(r):function(t,e){for(var i=0,r=t.length;i<r;i++)t[i]=e[i]}(n,r),t.renderer.state.uniformLocations.set(i,n)}else{if(n===r)return;t.renderer.state.uniformLocations.set(i,r)}switch(e){case 5126:return r.length?t.uniform1fv(i,r):t.uniform1f(i,r);case 35664:return t.uniform2fv(i,r);case 35665:return t.uniform3fv(i,r);case 35666:return t.uniform4fv(i,r);case 35670:case 5124:case 35678:case 35680:return r.length?t.uniform1iv(i,r):t.uniform1i(i,r);case 35671:case 35667:return t.uniform2iv(i,r);case 35672:case 35668:return t.uniform3iv(i,r);case 35673:case 35669:return t.uniform4iv(i,r);case 35674:return t.uniformMatrix2fv(i,!1,r);case 35675:return t.uniformMatrix3fv(i,!1,r);case 35676:return t.uniformMatrix4fv(i,!1,r)}}function z(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}var q=0;function X(t){q>100||(console.warn(t),++q>100&&console.warn("More than 100 program warnings - stopping logs."))}var Y=new M,W=1,j=function(){"use strict";function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.canvas,n=void 0===r?document.createElement("canvas"):r,s=e.width,a=void 0===s?300:s,o=e.height,h=void 0===o?150:o,u=e.dpr,l=void 0===u?1:u,c=e.alpha,d=void 0!==c&&c,f=e.depth,g=void 0===f||f,v=e.stencil,p=void 0!==v&&v,m=e.antialias,y=void 0!==m&&m,E=e.premultipliedAlpha,b=void 0!==E&&E,x=e.preserveDrawingBuffer,A=void 0!==x&&x,_=e.powerPreference,w=void 0===_?"default":_,T=e.autoClear,F=void 0===T||T,S=e.webgl,k=void 0===S?2:S;i(this,t);var R={alpha:d,depth:g,stencil:p,antialias:y,premultipliedAlpha:b,preserveDrawingBuffer:A,powerPreference:w};this.dpr=l,this.alpha=d,this.color=!0,this.depth=g,this.stencil=p,this.premultipliedAlpha=b,this.autoClear=F,this.id=W++,2===k&&(this.gl=n.getContext("webgl2",R)),this.isWebgl2=!!this.gl,this.gl||(this.gl=n.getContext("webgl",R)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(a,h),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}return n(t,[{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}},{key:"setViewport",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.state.viewport.x=i,this.state.viewport.y=r,this.gl.viewport(i,r,t,e))}},{key:"setScissor",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.gl.scissor(i,r,t,e)}},{key:"enable",value:function(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}},{key:"disable",value:function(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}},{key:"setBlendFunc",value:function(t,e,i,r){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===r||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=r,void 0!==i?this.gl.blendFuncSeparate(t,e,i,r):this.gl.blendFunc(t,e))}},{key:"setBlendEquation",value:function(t,e){t=t||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}},{key:"setCullFace",value:function(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}},{key:"setFrontFace",value:function(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}},{key:"setDepthMask",value:function(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}},{key:"setDepthFunc",value:function(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}},{key:"activeTexture",value:function(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}},{key:"bindFramebuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,i=void 0===e?this.gl.FRAMEBUFFER:e,r=t.buffer,n=void 0===r?null:r;this.state.framebuffer!==n&&(this.state.framebuffer=n,this.gl.bindFramebuffer(i,n))}},{key:"getExtension",value:function(t,e,i){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][i].bind(this.extensions[t]):null:this.extensions[t])}},{key:"sortOpaque",value:function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}},{key:"sortTransparent",value:function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}},{key:"sortUI",value:function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}},{key:"getRenderList",value:function(t){var e=t.scene,i=t.camera,r=t.frustumCull,n=t.sort,s=[];if(i&&r&&i.updateFrustum(),e.traverse((function(t){if(!t.visible)return!0;t.draw&&(r&&t.frustumCulled&&i&&!i.frustumIntersectsMesh(t)||s.push(t))})),n){var a=[],o=[],h=[];s.forEach((function(t){t.program.transparent?t.program.depthTest?o.push(t):h.push(t):a.push(t),t.zDepth=0,0===t.renderOrder&&t.program.depthTest&&i&&(t.worldMatrix.getTranslation(Y),Y.applyMatrix4(i.projectionViewMatrix),t.zDepth=Y.z)})),a.sort(this.sortOpaque),o.sort(this.sortTransparent),h.sort(this.sortUI),s=a.concat(o,h)}return s}},{key:"render",value:function(t){var e=t.scene,i=t.camera,r=t.target,n=void 0===r?null:r,s=t.update,a=void 0===s||s,o=t.sort,h=void 0===o||o,u=t.frustumCull,l=void 0===u||u,c=t.clear;null===n?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(n),this.setViewport(n.width,n.height)),(c||this.autoClear&&!1!==c)&&(!this.depth||n&&!n.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),a&&e.updateMatrixWorld(),i&&i.updateMatrixWorld(),this.getRenderList({scene:e,camera:i,frustumCull:l,sort:h}).forEach((function(t){t.draw({camera:i})}))}}]),t}();function H(t,e,i){return t[0]=e,t[1]=i,t}function Q(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function K(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Z(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function J(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function $(t,e){return t[0]=-e[0],t[1]=-e[1],t}function tt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function et(t,e){return t[0]*e[1]-t[1]*e[0]}var it=function(t){"use strict";o(s,t);var r=p(s);function s(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;return i(this,s),h(t=r.call(this,n,a),e(t))}return n(s,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return t.length?this.copy(t):(H(this,t,e),this)}},{key:"copy",value:function(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],this}},{key:"add",value:function(t,e){return e?Q(this,t,e):Q(this,this,t),this}},{key:"sub",value:function(t,e){return e?K(this,t,e):K(this,this,t),this}},{key:"multiply",value:function(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]*r[0],e[1]=i[1]*r[1]):Z(this,this,t),this}},{key:"divide",value:function(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]/r[0],e[1]=i[1]/r[1]):Z(this,this,1/t),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return tt(this,t),this}},{key:"len",value:function(){return J(this)}},{key:"distance",value:function(t){return t?(e=this,r=(i=t)[0]-e[0],n=i[1]-e[1],Math.sqrt(r*r+n*n)):J(this);var e,i,r,n}},{key:"squaredLen",value:function(){return this.squaredDistance()}},{key:"squaredDistance",value:function(t){return t?(e=this,r=(i=t)[0]-e[0],n=i[1]-e[1],r*r+n*n):function(t){var e=t[0],i=t[1];return e*e+i*i}(this);var e,i,r,n}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return $(this,t),this}},{key:"cross",value:function(t,e){return e?et(t,e):et(this,t)}},{key:"scale",value:function(t){return Z(this,this,t),this}},{key:"normalize",value:function(){var t,e,i,r,n;return t=this,i=(e=this)[0],r=e[1],(n=i*i+r*r)>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,this}},{key:"dot",value:function(t){return i=t,(e=this)[0]*i[0]+e[1]*i[1];var e,i}},{key:"equals",value:function(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1];var e,i}},{key:"applyMatrix3",value:function(t){var e,i,r,n,s;return e=this,r=t,n=(i=this)[0],s=i[1],e[0]=r[0]*n+r[3]*s+r[6],e[1]=r[1]*n+r[4]*s+r[7],this}},{key:"applyMatrix4",value:function(t){var e,i,r,n,s;return e=this,r=t,n=(i=this)[0],s=i[1],e[0]=r[0]*n+r[4]*s+r[12],e[1]=r[1]*n+r[5]*s+r[13],this}},{key:"lerp",value:function(t,e){return function(t,e,i,r){var n=e[0],s=e[1];t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s)}(this,this,t,e),this}},{key:"clone",value:function(){return new s(this[0],this[1])}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t}}]),s}(v(Array)),rt=new Uint8Array(4);function nt(t){return 0==(t&t-1)}var st,at=1,ot=function(){"use strict";function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.image,s=r.target,a=void 0===s?e.TEXTURE_2D:s,o=r.type,h=void 0===o?e.UNSIGNED_BYTE:o,u=r.format,l=void 0===u?e.RGBA:u,c=r.internalFormat,d=void 0===c?l:c,f=r.wrapS,g=void 0===f?e.CLAMP_TO_EDGE:f,v=r.wrapT,p=void 0===v?e.CLAMP_TO_EDGE:v,m=r.generateMipmaps,y=void 0===m||m,E=r.minFilter,b=void 0===E?y?e.NEAREST_MIPMAP_LINEAR:e.LINEAR:E,x=r.magFilter,A=void 0===x?e.LINEAR:x,_=r.premultiplyAlpha,w=void 0!==_&&_,T=r.unpackAlignment,F=void 0===T?4:T,S=r.flipY,k=void 0===S?a==e.TEXTURE_2D:S,R=r.anisotropy,I=void 0===R?0:R,P=r.level,M=void 0===P?0:P,L=r.layers,O=void 0===L?1:L,D=r.width,U=r.height,B=void 0===U?D:U;i(this,t),this.gl=e,this.id=at++,this.image=n,this.target=a,this.type=h,this.layers=O,this.format=l,this.internalFormat=d,this.minFilter=b,this.magFilter=A,this.wrapS=g,this.wrapT=p,this.generateMipmaps=y,this.premultiplyAlpha=w,this.unpackAlignment=F,this.flipY=k,this.anisotropy=Math.min(I,this.gl.renderer.parameters.maxAnisotropy),this.level=M,this.width=D,this.height=B,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}return n(t,[{key:"bind",value:function(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(var i=0;i<6;i++)this.gl.texImage3D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.level,this.internalFormat,this.format,this.type,this.image[i]);else if(ArrayBuffer.isView(this.image))this.gl.texImage3D(this.target,this.level,this.internalFormat,this.width,this.height,this.layers,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(var r=0;r<this.image.length;r++)this.gl.compressedTexImage3D(this.target,r,this.internalFormat,this.image[r].width,this.image[r].height,0,this.image[r].data);else this.gl.texImage3D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||nt(this.image.width)&&nt(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(var n=0;n<6;n++)this.gl.texImage3D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,rt);else this.width?this.gl.texImage3D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage3D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,rt);this.store.image=this.image}}}]),t}();st="#version 300 es\nprecision highp float;\nprecision highp sampler2DArray;\n#define GLSLIFY 1\nuniform float uTime;\nuniform int numQuads;\nuniform highp int width;\nuniform highp int height;\nin vec2 textureId;\nflat out int vid;\nout vec2 vemu_PointCoord;\n\nfloat hash(float p) {\n  vec2 p2 = fract(vec2(p * 5.3983, p * 5.4427));\n  p2 += dot(p2.yx, p2.xy + vec2(21.5351, 14.3137));\n  return fract(p2.x * p2.y * 95.4337);\n}\nvec2 rotate(vec2 v, float a) {\n\tfloat s = sin(a);\n\tfloat c = cos(a);\n\tmat2 m = mat2(c, -s, s, c);\n\treturn m * v;\n}\n\nvec2 rotateUV(vec2 uv, float rotation, vec2 mid)\n{\n    return vec2(\n      cos(rotation) * (uv.x - mid.x) + sin(rotation) * (uv.y - mid.y) + mid.x,\n      cos(rotation) * (uv.y - mid.y) - sin(rotation) * (uv.x - mid.x) + mid.y\n    );\n}\n\nvoid main() {\n\n  int qID = numQuads-gl_InstanceID;\n  float u = float(qID) / float(numQuads);\n  vid = int(textureId[0]);\n  float offset = (textureId[1]);\n\n  float x = offset*0.005;         \n  float y = offset*0.005; \n  float size =  (sin(uTime) + 3.0) * 10.;\n  float rotation = offset*0.02;\n  float rotXoffset=uTime;\n  float rotYoffset=uTime;\n\n  rotation *= (sin(uTime) + 1.0);\n\n  ivec2 unitQuad = ivec2(\n      gl_VertexID / 6 + gl_VertexID % 2,\n      (gl_VertexID / 2 + gl_VertexID / 3) % 2);\n\n  gl_Position = vec4(   vec2(x,y)  , u,  1.);\n  gl_Position.xy += (vec2(unitQuad) - 0.5) * 2.0 * size / vec2(width,height);\n  vec2 rot = rotateUV(gl_Position.xy, rotation,vec2(x + rotXoffset,y + rotYoffset)) ;\n  gl_Position.xy = rot;\n  vemu_PointCoord = vec2(unitQuad.x, 1.0 - float(unitQuad.y));\n}";var ht,ut,lt,ct,dt,ft;ht="#version 300 es\nprecision highp float;\n precision highp sampler2DArray;\n#define GLSLIFY 1\n#define PI 3.1415926538\n\nuniform float uTime;\nuniform sampler2DArray u_image;\nuniform sampler2D u_imagetest;\nuniform highp int width;\nuniform highp int height;\n\nflat in int vid;\nout vec4 color;\n\nin vec2 vemu_PointCoord;\n\nconst vec3 palette[8] = vec3[8](\n  vec3(0.255,0.741,0.349),\n  vec3(1.0,0.027,0.239),\n  vec3(0.5, 0.1, 0.2),\n  vec3(0.996,0.745,0.125),\n  vec3(0.604,0.573,1.0),\n  vec3(0.,0.325,1.0),\n  vec3(0.075,0.059,0.008),\n  vec3(0.925,0.941,0.988)\n);\n\nvoid drawTiles(){\n    vec2    uv = vemu_PointCoord.xy; \n    color = vec4(0.5);\n    if(uv.x < 0. || uv.x > 0. + 1.|| uv.y < 0. || uv.y > 0. + 1.) {\n       color = vec4(0.0,0.0,0.0,0.0);\n       return;\n    }\n\n    vec2 spriteSize = vec2(32.,32.);\n    \n    float spnum = float(vid );\n  \n    float dx = spriteSize.x / float(width);\n    float dy = spriteSize.y / float(height);\n    \n    float cols = float(width) / spriteSize.x;\n    \n    float index = mod(spnum  , cols*cols);\n    // From linear index to row/col pair\n    float col = mod(index, cols);\n    float row = floor(index / cols);\n    uv = vec2(dx * uv.x + (col/cols) ,   dy * uv.y + (row/cols) );\n    int currentLayer = int(floor(spnum / (cols*cols)));\n    vec3 currentPos = vec3(uv, float(currentLayer));\n    int indx = int(texture(u_image, currentPos).a * 255.0) ;\n    if(indx == 0 ){\n          color = vec4(0.0,0.0,0.0,0.0);\n       return;\n    }\n    color=  vec4(palette[indx],1.0);\n    \n    }\n\nvoid main() {\n   // if(gl_FragCoord.z > 1.0) discard;\n   // color = vec4(vec3(gl_FragCoord.z*1.), 1.0);\n\n    drawTiles();\n}\n\n";var gt={value:.5},vt={value:new it(0,0)},pt={value:0},mt=1024,yt=mt,Et=Math.floor(32),bt=20,xt=new Uint8Array(20971520);function At(t){for(var e=t.id,i=0;i<32;i++)for(var r=0;r<t.width;r++)xt[r+(i+32*Math.floor(e/Et))*mt+e%Et*32]=t.data[r+i*t.width]}function _t(){pt.value+=.01,ut.uniform1f(lt,pt.value),ut.viewport(0,0,ut.canvas.width,ut.canvas.height),ut.drawArraysInstanced(ut.TRIANGLES,0,6,ft),requestAnimationFrame(_t)}self.onmessage=function(e){var i,r;"offscreen"===e.data.msg&&(e.data.canvas.style={},function(e){ft=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;var i=new j({canvas:e});(ut=i.gl).clearColor(1,1,1,1);var r=new ot(ut,{target:ut.TEXTURE_2D_ARRAY,image:new Uint8Array(20971520),generateMipmaps:!1,format:ut.ALPHA,type:ut.UNSIGNED_BYTE,width:mt,layers:bt,magFilter:ut.NEAREST,minFilter:ut.NEAREST});if(ct=new G(ut,{vertex:t(st),fragment:t(ht),transparent:!0,cullFace:!1,uniforms:{uTime:pt,zoom:gt,pan:vt,width:{value:mt},height:{value:yt},u_image:{value:r},numQuads:{value:ft}}}),!ut.getProgramParameter(ct.program,ut.LINK_STATUS))throw new Error("shader compile error ^^^^^");ct.use(),(dt=new B(ut,{textureId:{size:2,data:new Float32Array,instanced:1}})).bindAttributes(ct),lt=ut.getUniformLocation(ct.program,"uTime"),requestAnimationFrame(_t)}(e.data.canvas,e.data.numparticles)),"resize"===e.data.msg&&(ut.canvas.width=.75*e.data.width,ut.canvas.height=.75*e.data.height),"uploadTextureBatch"===e.data.msg&&function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1024,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1024,a=Math.ceil(t.length/(Et*Et));t.forEach((function(t){return At(t)})),ut.texSubImage3D(ut.TEXTURE_2D_ARRAY,0,e,i,r,n,s,a,ut.ALPHA,ut.UNSIGNED_BYTE,xt)}(e.data.images),"updateAttribute"===e.data.msg&&(i=e.data.key,r=e.data.data,dt.attributes[i].data=r,dt.updateAttribute(dt.attributes[i]))}}();
//# sourceMappingURL=world.43864821.js.map
